<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="layout/_LayoutUser :: layout(
          'Chi ti·∫øt s·∫£n ph·∫©m',
          ~{::content},
          ~{}
      )">

<th:block th:fragment="content">
    <style>
        /* Tinh ch·ªânh b·ªë c·ª•c chi ti·∫øt */
        .product-detail-container {
            background: #fff;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        .img-detail-wrapper {
            background-color: #fdfdfd;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 12px;
        }

        .img-detail {
            max-height: 400px;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .img-detail:hover {
            transform: scale(1.02);
        }

        .product-info-box {
            padding: 10px 20px;
        }

        .product-name {
            font-weight: 800;
            color: #2d3436;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .product-price-large {
            font-size: 2rem;
            color: #d63031;
            font-weight: 800;
            margin-bottom: 20px;
            display: block;
        }

        .meta-item {
            margin-bottom: 10px;
            font-size: 0.95rem;
            color: #636e72;
        }

        .meta-item strong {
            color: #2d3436;
            width: 120px;
            display: inline-block;
        }

        /* Ph·∫ßn ƒë√°nh gi√° */
        .review-card {
            background: #fcfcfc;
            border-left: 4px solid #f4a100;
            margin-bottom: 15px;
            padding: 15px;
            transition: 0.3s;
        }

        .review-card:hover {
            background: #fff8eb;
        }

        .star-rating {
            color: #f4a100;
            font-weight: bold;
        }

        .review-form-box {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-top: 30px;
        }

        .btn-buy-now {
            background-color: #f4a100;
            border: none;
            padding: 12px 30px;
            font-weight: 700;
            border-radius: 8px;
            color: white;
            transition: 0.3s;
        }

        .btn-buy-now:hover {
            background-color: #e69500;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 161, 0, 0.3);
            color: white;
        }
    </style>

    <div class="mb-4">
        <a th:href="@{/sanpham}" class="text-muted text-decoration-none">
            <small>‚Üê Quay l·∫°i danh s√°ch s·∫£n ph·∫©m</small>
        </a>
    </div>

    <div th:if="${sp != null}" class="product-detail-container p-4">
        <div class="row">
            <div class="col-md-5">
                <div class="img-detail-wrapper border">
                    <img th:src="${sp.hinhAnh != null && sp.hinhAnh != ''} ? @{/images/{img}(img=${sp.hinhAnh})} : @{/images/no-image.png}"
                         alt="·∫¢nh s·∫£n ph·∫©m"
                         class="img-fluid img-detail">
                </div>
            </div>

            <div class="col-md-7">
                <div class="product-info-box">
                    <h2 class="product-name" th:text="${sp.ten}"></h2>

                    <span class="product-price-large"
                          th:text="${#numbers.formatDecimal(sp.gia,0,'POINT',0,'COMMA')} + ' ƒë'"></span>

                    <div class="meta-data mb-4">
                        <div class="meta-item">
                            <strong>Danh m·ª•c:</strong>
                            <span class="badge bg-light text-dark border" th:text="${sp.danhMuc != null ? sp.danhMuc.ten : 'Ch∆∞a ph√¢n lo·∫°i'}"></span>
                        </div>
                        <div class="meta-item">
                            <strong>Th∆∞∆°ng hi·ªáu:</strong>
                            <span th:text="${sp.thuongHieu != null ? sp.thuongHieu.ten : 'Ch∆∞a c√≥ th∆∞∆°ng hi·ªáu'}"></span>
                        </div>
                        <div class="meta-item mt-3">
                            <strong>M√¥ t·∫£:</strong>
                            <p class="mt-2 text-secondary" style="line-height: 1.8;" th:text="${sp.moTa}"></p>
                        </div>
                    </div>

                    <hr>

                    <div class="mt-4">
                        <div class="mt-4">
                            <div sec:authorize="isAuthenticated()">
                                <form th:action="@{/giohang/add}" method="post">
                                    <input type="hidden" name="productId" th:value="${sp.id}" />
                                    <input type="hidden" name="quantity" value="1" />
                                    <button type="submit" class="btn btn-buy-now">
                                        üõí TH√äM V√ÄO GI·ªé H√ÄNG
                                    </button>
                                </form>
                            </div>

                            <div sec:authorize="!isAuthenticated()">
                                <div class="alert alert-light border shadow-sm">
                                    üí° B·∫°n c·∫ßn
                                    <a th:href="@{/auth/login}" class="fw-bold text-primary">ƒëƒÉng nh·∫≠p</a>
                                    ƒë·ªÉ mua s·∫£n ph·∫©m n√†y.
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-5">
        <h4 class="fw-bold mb-4">ƒê√°nh gi√° t·ª´ kh√°ch h√†ng</h4>

        <div th:if="${listDanhGia == null || #lists.isEmpty(listDanhGia)}" class="text-center py-4">
            <p class="text-muted">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë√°nh gi√° s·∫£n ph·∫©m n√†y!</p>
        </div>

        <div th:each="dg : ${listDanhGia}" class="review-card rounded shadow-sm">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <div>
                    <strong class="text-dark" th:text="${dg.nguoiDung != null ? dg.nguoiDung.username : 'Ng∆∞·ªùi d√πng'}"></strong>
                    <span class="star-rating ms-2">
                        <span th:each="i : ${#numbers.sequence(1, dg.soSao)}">‚≠ê</span>
                    </span>
                </div>
                <small class="text-muted" th:text="${#temporals.format(dg.thoiGian,'dd/MM/yyyy HH:mm')}"></small>
            </div>
            <p class="mb-0 text-secondary" th:text="${dg.binhLuan}"></p>
        </div>

        <div sec:authorize="isAuthenticated()" class="review-form-box shadow-sm">
            <h5 class="fw-bold mb-3">G·ª≠i ƒë√°nh gi√° c·ªßa b·∫°n</h5>
            <form th:action="@{/sanpham/danhgia/{id}(id=${sp.id})}" method="post" th:object="${newDanhGia}">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label fw-bold small">S·ªë sao</label>
                        <select class="form-select border-0 shadow-sm" th:field="*{soSao}" required>
                            <option th:value="null">-- Ch·ªçn m·ª©c ƒë·ªô h√†i l√≤ng --</option>
                            <option value="5">5 ‚≠ê (Tuy·ªát v·ªùi)</option>
                            <option value="4">4 ‚≠ê (T·ªët)</option>
                            <option value="3">3 ‚≠ê (B√¨nh th∆∞·ªùng)</option>
                            <option value="2">2 ‚≠ê (K√©m)</option>
                            <option value="1">1 ‚≠ê (R·∫•t t·ªá)</option>
                        </select>
                    </div>
                    <div class="col-12 mb-3">
                        <label class="form-label fw-bold small">N·ªôi dung b√¨nh lu·∫≠n</label>
                        <textarea class="form-control border-0 shadow-sm" th:field="*{binhLuan}" rows="3" placeholder="Chia s·∫ª tr·∫£i nghi·ªám c·ªßa b·∫°n v·ªÅ s·∫£n ph·∫©m..." required></textarea>
                    </div>
                </div>
                <button class="btn btn-dark px-4 fw-bold">G·ª≠i ƒë√°nh gi√° ngay</button>
            </form>
        </div>

        <div sec:authorize="!isAuthenticated()" class="mt-4 text-center p-4 bg-light rounded shadow-sm">
            <p class="mb-0">Vui l√≤ng <a th:href="@{/auth/login}" class="text-primary fw-bold">ƒêƒÉng nh·∫≠p</a> ƒë·ªÉ g·ª≠i nh·∫≠n x√©t v·ªÅ s·∫£n ph·∫©m.</p>
        </div>
    </div>

</th:block>
</html>