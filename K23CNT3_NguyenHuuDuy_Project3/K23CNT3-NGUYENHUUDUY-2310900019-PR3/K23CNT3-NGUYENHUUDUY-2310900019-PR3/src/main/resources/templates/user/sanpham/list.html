<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="layout/_LayoutUser :: layout(
          'Danh sách sản phẩm',
          ~{::content},
          ~{}
      )">

<th:block th:fragment="content">

    <h2>Danh sách sản phẩm</h2>

    <div class="row">

        <!-- KHÔNG CÓ SẢN PHẨM -->
        <div class="col-12" th:if="${list == null || #lists.isEmpty(list)}">
            <p class="text-danger text-center">
                Hiện chưa có sản phẩm nào.
            </p>
        </div>

        <!-- CÓ SẢN PHẨM -->
        <div class="col-md-3 mb-4" th:each="sp : ${list}">
            <div class="card h-100">

                <!-- ẢNH SẢN PHẨM -->
                <img th:src="${sp.hinhAnh != null && sp.hinhAnh != ''} ? @{/images/{img}(img=${sp.hinhAnh})} : @{/images/no-image.png}"
                     class="card-img-top"
                     alt="Ảnh sản phẩm"
                     style="height:180px; object-fit:cover">

                <div class="card-body">
                    <h6 class="card-title" th:text="${sp.ten}"></h6>
                    <p class="text-danger fw-bold">
                        <span th:text="${#numbers.formatDecimal(sp.gia,0,'POINT',0,'COMMA')}"></span> đ
                    </p>
                    <p class="small text-muted"
                       th:text="${sp.thuongHieu != null ? sp.thuongHieu.ten : 'Chưa rõ thương hiệu'}"></p>
                </div>

                <div class="card-footer d-flex justify-content-between">
                    <a th:href="@{/sanpham/{id}(id=${sp.id})}" class="btn btn-primary btn-sm">
                        Xem chi tiết
                    </a>

                    <!-- Form mua ngay -->
                    <sec:authorize access="isAuthenticated()">
                        <form th:action="@{/giohang/add}" method="post">
                            <input type="hidden" name="productId" th:value="${sp.id}" />
                            <button type="submit" class="btn btn-success btn-sm">
                                Mua ngay
                            </button>
                        </form>
                    </sec:authorize>

<!--                    <sec:authorize access="!isAuthenticated()">-->
<!--                        <a th:href="@{/login}" class="btn btn-warning btn-sm">Đăng nhập để mua</a>-->
<!--                    </sec:authorize>-->

                </div>

            </div>
        </div>

    </div>

</th:block>
</html>
